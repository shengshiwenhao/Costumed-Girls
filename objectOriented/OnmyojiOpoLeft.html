<!DOCTYPE html>
<html>
<head>
	<title>阴阳师Onmyoji.XX(left)</title>
	<meta charset="utf-8">
	<style type="text/css">
	*{
		margin:0;
		padding: 0;
	}
	h1{
		width: 28%;
		height: 100%;
		font-size: 36px;
		float: left;
		border: 10px #999 solid;
		box-sizing: border-box;
		background: url(../img/yys/yysh1.jpg);
		background-size: 100% 100%;	
		overflow: hidden;
		color:orange;
	}
	h1 span{
		display: inline-block;
		margin: 20px 0;
	}
	h1 button{
		height: 50px;
		background: rgba(10,30,200,0.1);;
		font-size: 24px;
		font-weight: 700;
		color:orange;
	}
	h1 .start{
		width: 100%;	
	}
	h1 .suspend,h1 .proceed{
		float: left;
		width: 50%;
	}
	h1 nav{
		font-weight: 700;
		font-size: 28px;
		margin-top: 10px;
	}
	html,body{
		width: 100%;
		height: 100%;
	}
	article{
		width: 72%;
		height: 100%;
		border: 10px #999 solid;
		box-sizing: border-box;
		float: right;
		position: relative;
	}
	article img{
		width: 100%;
		height: 100%;
		display: none;
	}
	article div{
		width: 100%;
		height: 12.5%;
		overflow: hidden;
		cursor: pointer;
	}
	article p{	
		float: left;
		width: 8.333%;
		height: 100%;
		border: 1px solid #ccc;
		box-sizing: border-box;
		background: rgba(225,78,15,0.7);
		position: relative;
	}
	/*游戏结束盒子*/
	#gameover { 
	   position: absolute; 
	   left: 40%;  
	   top: 30%; 
	   width: 25%; 
	   height: 30%; 
	   box-sizing: border-box;
	   box-shadow: 0 0 4px #222222; 
	   background-color: #e1e1e1;
	   background:url(../img/yys/yysfo.jpg);
	   background-size: 120% 100%;
	   text-align: center;  
	   display: none; 
	}
	#gameover u { 
	   display: block;
	   width: 100%; 
	   height: 20%; 
	   text-align: center; 
	   font-size: 36px; 
	   color: #000000; 
	   font-weight: 700;
	   text-decoration:none;	
	}
	#gameover .qd{ 
	   width: 60%; 
	   height: 25%; 
	   text-align: center; 
	   font-size: 20px; 
	   background: #336688; 
	   color: #ffffff; 
	   border-radius: 30%;
	   margin-left: 20%;
	   line-height: 250%; 
	}
	#gameover .nl{ 
	   text-align: center; 
	   font-size: 20px; 
	   color: #000000;   
	}
	</style>
</head>
<body>
	<h1>
		<button class="start">开始</button>
		<button class="suspend">暂停/切换背景</button>
		<button class="proceed">继续</button>
		</br>
		阴阳师<small>(面向对象版)</small><br/>
		Onmyoji.XX(left)
		</br>
		<span>分数：</span>
		<b></b>
		</br>
		<span>时间：</span>
		<strong></strong>
		</br>
		<span>最高分：</span>
		<big></big>
		</br>
		<nav>
			游戏说明：<br/>
			玩家点击开始按钮,游戏开始;<br/>
			游戏两两翻牌，一样则积两分;<br/>
			不一样，则两张都恢复初始状态;<br/>
			当所有卡牌配对成功后即获得胜利。<br/>
		</nav>
	</h1>
	<article>
		<div>
			<p><img class = "yys00" src="../img/yys/yys00.jpg"></p>
			<p><img class = "yys01" src="../img/yys/yys01.jpg"></p>
			<p><img class = "yys02" src="../img/yys/yys02.jpg"></p>
			<p><img class = "yys03" src="../img/yys/yys03.jpg"></p>
			<p><img class = "yys04" src="../img/yys/yys04.jpg"></p>
			<p><img class = "yys05" src="../img/yys/yys05.jpg"></p>
			<p><img class = "yys06" src="../img/yys/yys06.jpg"></p>
			<p><img class = "yys07" src="../img/yys/yys07.jpg"></p>
			<p><img class = "yys08" src="../img/yys/yys08.jpg"></p>
			<p><img class = "yys09" src="../img/yys/yys09.jpg"></p>
			<p><img class = "yys10" src="../img/yys/yys10.jpg"></p>
			<p><img class = "yys11" src="../img/yys/yys11.jpg"></p>
		</div>
		<div>
			<p><img class = "yys12" src="../img/yys/yys12.jpg"></p>
			<p><img class = "yys13" src="../img/yys/yys13.jpg"></p>
			<p><img class = "yys14" src="../img/yys/yys14.jpg"></p>
			<p><img class = "yys15" src="../img/yys/yys15.jpg"></p>
			<p><img class = "yys16" src="../img/yys/yys16.jpg"></p>
			<p><img class = "yys17" src="../img/yys/yys17.jpg"></p>
			<p><img class = "yys18" src="../img/yys/yys18.jpg"></p>
			<p><img class = "yys19" src="../img/yys/yys19.jpg"></p>
			<p><img class = "yys20" src="../img/yys/yys20.jpg"></p>
			<p><img class = "yys21" src="../img/yys/yys21.jpg"></p>
			<p><img class = "yys22" src="../img/yys/yys22.jpg"></p>
			<p><img class = "yys23" src="../img/yys/yys23.jpg"></p>
		</div>
		<div>
			<p><img class = "yys00" src="../img/yys/yys00.jpg"></p>
			<p><img class = "yys01" src="../img/yys/yys01.jpg"></p>
			<p><img class = "yys02" src="../img/yys/yys02.jpg"></p>
			<p><img class = "yys03" src="../img/yys/yys03.jpg"></p>
			<p><img class = "yys04" src="../img/yys/yys04.jpg"></p>
			<p><img class = "yys05" src="../img/yys/yys05.jpg"></p>
			<p><img class = "yys06" src="../img/yys/yys06.jpg"></p>
			<p><img class = "yys07" src="../img/yys/yys07.jpg"></p>
			<p><img class = "yys08" src="../img/yys/yys08.jpg"></p>
			<p><img class = "yys09" src="../img/yys/yys09.jpg"></p>
			<p><img class = "yys10" src="../img/yys/yys10.jpg"></p>
			<p><img class = "yys11" src="../img/yys/yys11.jpg"></p>
		</div>
		<div>
			<p><img class = "yys12" src="../img/yys/yys12.jpg"></p>
			<p><img class = "yys13" src="../img/yys/yys13.jpg"></p>
			<p><img class = "yys14" src="../img/yys/yys14.jpg"></p>
			<p><img class = "yys15" src="../img/yys/yys15.jpg"></p>
			<p><img class = "yys16" src="../img/yys/yys16.jpg"></p>
			<p><img class = "yys17" src="../img/yys/yys17.jpg"></p>
			<p><img class = "yys18" src="../img/yys/yys18.jpg"></p>
			<p><img class = "yys19" src="../img/yys/yys19.jpg"></p>
			<p><img class = "yys20" src="../img/yys/yys20.jpg"></p>
			<p><img class = "yys21" src="../img/yys/yys21.jpg"></p>
			<p><img class = "yys22" src="../img/yys/yys22.jpg"></p>
			<p><img class = "yys23" src="../img/yys/yys23.jpg"></p>
		</div>
		<div>
			<p><img class = "yys00" src="../img/yys/yys00.jpg"></p>
			<p><img class = "yys01" src="../img/yys/yys01.jpg"></p>
			<p><img class = "yys02" src="../img/yys/yys02.jpg"></p>
			<p><img class = "yys03" src="../img/yys/yys03.jpg"></p>
			<p><img class = "yys04" src="../img/yys/yys04.jpg"></p>
			<p><img class = "yys05" src="../img/yys/yys05.jpg"></p>
			<p><img class = "yys06" src="../img/yys/yys06.jpg"></p>
			<p><img class = "yys07" src="../img/yys/yys07.jpg"></p>
			<p><img class = "yys08" src="../img/yys/yys08.jpg"></p>
			<p><img class = "yys09" src="../img/yys/yys09.jpg"></p>
			<p><img class = "yys10" src="../img/yys/yys10.jpg"></p>
			<p><img class = "yys11" src="../img/yys/yys11.jpg"></p>
		</div>
		<div>
			<p><img class = "yys12" src="../img/yys/yys12.jpg"></p>
			<p><img class = "yys13" src="../img/yys/yys13.jpg"></p>
			<p><img class = "yys14" src="../img/yys/yys14.jpg"></p>
			<p><img class = "yys15" src="../img/yys/yys15.jpg"></p>
			<p><img class = "yys16" src="../img/yys/yys16.jpg"></p>
			<p><img class = "yys17" src="../img/yys/yys17.jpg"></p>
			<p><img class = "yys18" src="../img/yys/yys18.jpg"></p>
			<p><img class = "yys19" src="../img/yys/yys19.jpg"></p>
			<p><img class = "yys20" src="../img/yys/yys20.jpg"></p>
			<p><img class = "yys21" src="../img/yys/yys21.jpg"></p>
			<p><img class = "yys22" src="../img/yys/yys22.jpg"></p>
			<p><img class = "yys23" src="../img/yys/yys23.jpg"></p>
		</div>
		<div>
			<p><img class = "yys00" src="../img/yys/yys00.jpg"></p>
			<p><img class = "yys01" src="../img/yys/yys01.jpg"></p>
			<p><img class = "yys02" src="../img/yys/yys02.jpg"></p>
			<p><img class = "yys03" src="../img/yys/yys03.jpg"></p>
			<p><img class = "yys04" src="../img/yys/yys04.jpg"></p>
			<p><img class = "yys05" src="../img/yys/yys05.jpg"></p>
			<p><img class = "yys06" src="../img/yys/yys06.jpg"></p>
			<p><img class = "yys07" src="../img/yys/yys07.jpg"></p>
			<p><img class = "yys08" src="../img/yys/yys08.jpg"></p>
			<p><img class = "yys09" src="../img/yys/yys09.jpg"></p>
			<p><img class = "yys10" src="../img/yys/yys10.jpg"></p>
			<p><img class = "yys11" src="../img/yys/yys11.jpg"></p>
		</div>
		<div>
			<p><img class = "yys12" src="../img/yys/yys12.jpg"></p>
			<p><img class = "yys13" src="../img/yys/yys13.jpg"></p>
			<p><img class = "yys14" src="../img/yys/yys14.jpg"></p>
			<p><img class = "yys15" src="../img/yys/yys15.jpg"></p>
			<p><img class = "yys16" src="../img/yys/yys16.jpg"></p>
			<p><img class = "yys17" src="../img/yys/yys17.jpg"></p>
			<p><img class = "yys18" src="../img/yys/yys18.jpg"></p>
			<p><img class = "yys19" src="../img/yys/yys19.jpg"></p>
			<p><img class = "yys20" src="../img/yys/yys20.jpg"></p>
			<p><img class = "yys21" src="../img/yys/yys21.jpg"></p>
			<p><img class = "yys22" src="../img/yys/yys22.jpg"></p>
			<p><img class = "yys23" src="../img/yys/yys23.jpg"></p>
		</div>
		<footer id="gameover">
			<u>Gamer Over</u>
			<u>您最后的分数是</u>
			<u></u>
    		<u class="qd">确定</u>
    		<u class="nl">不要灰心，继续努力！</u>
		</footer>		
	</article>
</body>
</html>
<script type="text/javascript">
var scoreBox = document.querySelector("h1 b");
var timeBox =  document.querySelector("h1 strong");
var bigScore = document.querySelector("h1 big");
var start =  document.querySelector("h1 .start");
var suspend =  document.querySelector("h1 .suspend");
var proceed =  document.querySelector("h1 .proceed");
var article = document.querySelector("article");
var divs = document.querySelectorAll("article div");
var ps = document.querySelectorAll("article p");
var pictures = document.querySelectorAll("article img");
var gameover = document.querySelector("#gameover");
function Ball(ctr) {
    this.ctr = ctr;
    this.ctr.style.position = "relative";
    this.ball = document.createElement("div");
    this.ctr.appendChild(this.ball);
    this.ball.style.position = "absolute";
    this.r = this.ranNum(20, 50);
    this.ball.style.width = this.ball.style.height = this.r * 2 + "px";
    this.ball.style.borderRadius = "50%";
    this.ball.style.opacity = 0.5;
    this.ball.style.background = "url(../img/yys/paopao2.png)";
    this.ball.style.backgroundSize = "100% 100%";
    this.x = this.ranNum(0, this.ctr.clientWidth - this.r * 2);
    this.y = this.ranNum(0, this.ctr.clientHeight - this.r * 2);
    this.ball.style.left = this.x + "px";
    this.ball.style.top = this.y + "px";
    this.speedX = this.ranNum(1, 3) * (this.ranNum(0, 1) ? -1 : 1);
    this.speedY = this.ranNum(1, 3) * (this.ranNum(0, 1) ? -1 : 1);
    this.move();
}
Ball.prototype = {
    constructor:Ball,
    move:function(){
        var that = this;
        window.timer = setInterval(function(){
            that.x += that.speedX;
            that.y += that.speedY;
            if (that.x <= 0){
                that.x = 0;
                that.speedX *= -1;
            }
            if (that.x >= that.ctr.clientWidth - that.r * 2){
                that.x = that.ctr.clientWidth - that.r * 2;
                that.speedX *= -1;
            }
            if (that.y <= 0){
                that.y = 0;
                that.speedY *= -1;
            }
            if (that.y >= that.ctr.clientHeight - that.r * 2){
                that.y = that.ctr.clientHeight - that.r * 2;
                that.speedY *= -1;
            }
            that.ball.style.left = that.x + "px";
            that.ball.style.top = that.y + "px";
        },10)
    },
    ranNum:function(x,y){
        return Math.floor(Math.random() * (y - x+1) + x);
    }
}
function XxPlay(scoreBox,timeBox,bigScore,article,divs,ps,pictures,suspend,proceed,gameover){
	this.scoreBox = scoreBox;
	this.timeBox =  timeBox;
	this.bigScore = bigScore;
	this.article = article;
	this.divs = divs;
	this.ps = ps;
	this.pictures = pictures;
	this.suspend = suspend;
	this.proceed =proceed;
	this.gameover = gameover;
	this.pause = false;
	this.countdown = null;
	this.score = 0;
	this.hits = 0;
	this.bgSwitch = 1;
	this.pictureArr = new Array();		  
	this.init();
}
(function(bg,th){
	bigScore.innerHTML = localStorage.getItem("最高分"+bg);
	for (var i = 0; i < th+1; i++) {
		new Ball(article);
	}
})("yys",ps.length/5)
XxPlay.prototype = {
	constructor:XxPlay,
	init:function(){
		var that = this;
		this.rules(2,7,12,96,"yys");
		this.disOrder(8,12,"yys");
		this.pcbgs("yys","100% 100%",51);
		setTimeout(function(){
			that.countDown(360);
		},2000);
	},
	rules:function(step,th,spacing,totalPoints,bg){
		var that = this;
		for (var i = 0; i < this.ps.length; i++) {
			this.ps[i].idx = i;
			this.ps[i].onclick = function(){
				that.hits++;
				if(that.hits==3){ 
					if(that.pictures[that.pictureArr[0]].className != that.pictures[that.pictureArr[1]].className){
						that.pictures[that.pictureArr[0]].style.display = "none";
						that.pictures[that.pictureArr[1]].style.display = "none";
					}
					that.hits=1; 
					that.pictureArr = new Array(); 
				}
				that.pictures[this.idx].style.display = "block"; 
				that.pictureArr[that.hits-1] = this.idx; 
				if (that.hits == 2&&that.pictureArr[0]==that.pictureArr[1]) {
					that.hits = 1;
				}
				if(that.hits == 2&&that.pictureArr[0]!=that.pictureArr[1]){
					if(that.pictures[that.pictureArr[0]].className == that.pictures[that.pictureArr[1]].className){
						setTimeout(function(){ 
							that.ps[that.pictureArr[0]].style.display = "none";
							that.ps[that.pictureArr[1]].style.display = "none";
							that.score += step;
							that.scoreBox.innerHTML=that.score.length>2?that.score:"0"+that.score;
							for (var k = 1; k <= th; k++) {
								if (that.score == k*spacing){
									for (var i =0; i<that.ps.length; i++) {
										that.ps[i].style.background = "url(../img/"+bg+"/"+bg+"b"+(k+1)+".jpg)";
										that.ps[i].style.backgroundSize = "100% 100%";
									}
								}
							}
							if (that.score == totalPoints) {
								max = that.score+that.countdown;
								that.scoreBox.innerHTML = that.score+"+"+that.countdown+"="+max;
								that.timeBox.innerHTML="恭喜通关";
								clearInterval(window.timer);
								that.divsDisplay("none");
								if(localStorage.getItem("最高分"+bg)){
									mm = localStorage.getItem("最高分"+bg);
								}else{
									localStorage.setItem("最高分"+bg,max);
								}
								if (max>mm&&mm) {
									localStorage.setItem("最高分"+bg,max);
								}
								that.gameOver(false);
							}
						},200);					
					}
				}
			}
		}
	},
	disOrder:function(w,h,bg){
		this.gameover.style.display = 'none';
		for (var i = 0; i < this.ps.length; i++) {
			this.ps[i].style.display = "block";
			this.ps[i].style.zIndex = 999;
			this.ps[i].style.background = "url(../img/"+bg+"/"+bg+"b1.jpg)";
			this.ps[i].style.backgroundSize = "100% 100%";
			this.pictures[i].style.display = "none";
			var a = Math.floor(Math.random()*w);
			var b = Math.floor(Math.random()*w);
			var c = Math.floor(Math.random()*h);
			var d = Math.floor(Math.random()*h);
			this.divs[b].appendChild(this.divs[a].children[c]);
			this.divs[a].appendChild(this.divs[b].children[d]);
		}
		this.divsDisplay("block");
	},
	pcbgs:function(bg,bs,th){
		var that = this;
		this.article.style.background="url(../img/"+bg+"/"+bg+"xx"+this.bgSwitch+".jpg)";
		this.article.style.backgroundSize= bs;
		this.suspend.onclick = function(){
			that.article.style.background="url(../img/"+bg+"/"+bg+"xx"+that.bgSwitch+".jpg)";
			that.article.style.backgroundSize= bs;
			if (that.bgSwitch == th) {
				that.bgSwitch = 0;
			}
			that.bgSwitch++;
			that.pause = true;
			that.divsDisplay("none");
		}
		this.proceed.onclick = function(){
			that.pause = false;
			that.bgSwitch--;
			if (that.bgSwitch == 0) {
				that.bgSwitch = 1;
			}
			if (that.countdown>0) {
				that.divsDisplay("block");
			}		
		}
	},
	countDown:function(count){
		clearInterval(window.timer);
		this.countdown = count;
		this.score = 0;
		this.scoreBox.innerHTML =this.score.length>2?this.score:"0"+this.score;
		this.timeBox.innerHTML = this.countdown;
		var that = this;
		window.timer=setInterval(function(){
			if(that.pause ==false){
				that.countdown--;
			}else{
				return false;
			}
			that.timeBox.innerHTML = String(that.countdown).length>2?that.countdown:"0"+that.countdown;
			if (that.countdown<=0) {
				that.timeBox.innerHTML = "Game over";
				clearInterval(window.timer);
				that.divsDisplay("none");
				that.gameOver(true);
			}
		},1000)
	},
	divsDisplay:function(value){
		for (var i = 0; i < this.divs.length; i++) {
			this.divs[i].style.display = value;
		}
	},
	gameOver:function(flag){
		this.gameover.style.display = 'block';
		if (flag == true) {
			this.gameover.children[2].innerHTML = (this.score.length>2?this.score:"0"+this.score)+"分";
		}else{
			this.gameover.children[0].innerHTML = "恭喜您通关了";
			this.gameover.children[2].innerHTML = max+"分";
			this.gameover.children[4].innerHTML = "再接再厉，再创佳绩";
		}
		this.gameover.children[3].onclick = function(){
			location.reload();
		}
	}
}
start.onclick = function(){
	var xxPlays = new XxPlay(scoreBox,timeBox,bigScore,article,divs,ps,pictures,suspend,proceed,gameover);   
}
</script>